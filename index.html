<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zetallix - Quiz & Cash</title>
    <style>
        :root { --p-color: #2563eb; --s-color: #10b981; --bg: #f3f4f6; }
        body { font-family: sans-serif; background: var(--bg); margin: 0; display: flex; justify-content: center; }
        #app { width: 100%; max-width: 450px; background: white; min-height: 100vh; position: relative; display: flex; flex-direction: column; }
        
        /* Encabezado */
        .top-bar { background: var(--p-color); color: white; padding: 15px; display: flex; justify-content: space-between; align-items: center; font-weight: bold; }
        .coin-box { background: rgba(0,0,0,0.2); padding: 5px 12px; border-radius: 20px; }
        
        /* Pantallas */
        .screen { padding: 20px; display: none; flex: 1; }
        .active { display: block; }
        
        /* Botones */
        .menu-btn { width: 100%; padding: 15px; margin: 10px 0; border: none; border-radius: 12px; font-size: 1rem; font-weight: bold; cursor: pointer; color: white; }
        .btn-ad { background: #f59e0b; }
        .btn-play { background: var(--s-color); }
        .btn-pay { background: #6366f1; }
        .btn-gray { background: #6b7280; }
        .mute-btn { background: none; border: none; font-size: 1.5rem; cursor: pointer; color: white; }

        /* Juego y Niveles */
        .levels-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin-top: 20px; }
        .lvl-btn { aspect-ratio: 1; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; color: white; }
        .opt-btn { background: white; border: 2px solid #e5e7eb; width: 100%; padding: 15px; margin: 8px 0; border-radius: 10px; font-weight: bold; cursor: pointer; text-align: left; }
    </style>
</head>
<body>

<div id="app">
    <div class="top-bar">
        <div style="display: flex; align-items: center; gap: 10px;">
            <button class="mute-btn" id="btn-audio" onclick="toggleMute()">ðŸ”Š</button>
            <span>ZETALLIX</span>
        </div>
        <div class="coin-box">ðŸ’° <span id="coin-count">0</span></div>
    </div>

    <div id="scr-home" class="screen active">
        <button class="menu-btn btn-ad" onclick="recompensarAnuncio(50)">ðŸ“º Ver Anuncio (+50 ðŸ’°)</button>
        <button class="menu-btn btn-play" onclick="navegar('scr-groups')">ðŸŽ® Jugar</button>
        <button class="menu-btn btn-pay" onclick="navegar('scr-shop')">ðŸ’³ Canjear PayPal</button>
    </div>

    <div id="scr-groups" class="screen">
        <h2>Dificultad</h2>
        <button class="menu-btn" style="background:#3b82f6" onclick="seleccionarGrupo('FÃ¡cil')">FÃ¡cil</button>
        <button class="menu-btn" style="background:#10b981" onclick="seleccionarGrupo('Media')">Media</button>
        <button class="menu-btn btn-gray" onclick="navegar('scr-home')">Volver</button>
    </div>

    <div id="scr-levels" class="screen">
        <h2 id="lvl-title">Niveles</h2>
        <div id="levels-container" class="levels-grid"></div>
        <button class="menu-btn btn-gray" onclick="navegar('scr-groups')">Volver</button>
    </div>

    <div id="scr-quiz" class="screen">
        <h3 id="q-texto">Cargando...</h3>
        <div id="q-opciones"></div>
    </div>

    <div id="scr-shop" class="screen">
        <h2>Tienda ðŸ’³</h2>
        <div id="shop-list"></div>
        <button class="menu-btn btn-gray" onclick="navegar('scr-home')">Volver</button>
    </div>
</div>

<script>
    // ConfiguraciÃ³n AdMob y Estado Inicial
    const ADMOB_ID = "ca-app-pub-6417146963108410/6814686673";
    let monedas = 0, sonidoActivo = true, progreso = {"FÃ¡cil": 1, "Media": 1};
    let grupoActual = "", qIndex = 0, bancoPreguntas = [];

    // --- SISTEMA DE AUDIO ---
    // Usamos una nota sintetizada para evitar archivos externos que puedan fallar en la APK
    function reproducirEfecto() {
        if (!sonidoActivo) return;
        try {
            const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.frequency.setValueAtTime(550, audioCtx.currentTime);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            osc.start();
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
            osc.stop(audioCtx.currentTime + 0.1);
        } catch(e) { console.log("Audio no soportado"); }
    }

    function toggleMute() {
        sonidoActivo = !sonidoActivo;
        document.getElementById('btn-audio').innerText = sonidoActivo ? "ðŸ”Š" : "ðŸ”‡";
    }

    // --- CARGA DE DATOS ---
    fetch('Ps1_comas_final.csv')
        .then(res => res.text())
        .then(csv => {
            const filas = csv.split('\n').slice(1);
            bancoPreguntas = filas.filter(f => f.trim() !== "").map(f => {
                const c = f.split(',');
                return { p: c[0], cor: c[1], ops: [c[1], c[2], c[3], c[4]], diff: c[5]?.trim() };
            });
        }).catch(err => console.log("Error cargando CSV"));

    // --- NAVEGACIÃ“N Y ANUNCIOS ---
    function navegar(id) {
        reproducirEfecto();
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        if(id === 'scr-shop') actualizarTienda();
    }

    function recompensarAnuncio(valor) {
        reproducirEfecto();
        // Llamada a la interfaz nativa de Web2App
        if (window.JSInterface && window.JSInterface.showInterstitial) {
            window.JSInterface.showInterstitial(ADMOB_ID);
        }
        monedas += valor;
        document.getElementById('coin-count').innerText = monedas;
    }

    // --- LÃ“GICA DEL JUEGO (Simplificada) ---
    function seleccionarGrupo(g) {
        grupoActual = g;
        navegar('scr-levels');
        dibujarNiveles();
    }

    function dibujarNiveles() {
        const cont = document.getElementById('levels-container');
        cont.innerHTML = "";
        for(let i=1; i<=15; i++) {
            const btn = document.createElement('button');
            btn.className = 'lvl-btn';
            const unlock = i <= progreso[grupoActual];
            btn.innerText = unlock ? i : "ðŸ”’";
            btn.style.background = unlock ? "var(--p-color)" : "#ccc";
            if(unlock) btn.onclick = () => { qIndex = 0; navegar('scr-quiz'); iniciarQuiz(); };
            cont.appendChild(btn);
        }
    }

    function iniciarQuiz() {
        const q = bancoPreguntas.filter(p => p.diff === grupoActual)[0]; // Ejemplo
        document.getElementById('q-texto').innerText = q.p;
        const opts = document.getElementById('q-opciones');
        opts.innerHTML = "";
        q.ops.forEach(o => {
            const b = document.createElement('button');
            b.className = 'opt-btn'; b.innerText = o;
            b.onclick = () => {
                if(o === q.cor) { monedas += 10; navegar('scr-levels'); }
                else { alert("Incorrecto"); navegar('scr-home'); }
            };
            opts.appendChild(b);
        });
    }

    function actualizarTienda() {
        const cont = document.getElementById('shop-list');
        cont.innerHTML = `<div style="padding:10px; border-bottom:1px solid #eee">
            PayPal 0.10â‚¬ - 10000 ðŸ’° <button class="menu-btn btn-pay" style="width:auto; float:right">Canjear</button>
        </div>`;
    }
</script>
</body>
</html>
