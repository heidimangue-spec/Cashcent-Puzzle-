<!DOCTYPE html>  <html lang="es">    <head>    
<meta charset="UTF-8">    
<meta name="viewport" content="width=device-width, initial-scale=1.0">    
<title>CashCent Puzzle</title>  <style>    
:root{    
  --p:#2563eb;    
  --s:#10b981;    
  --bg:#f3f4f6;    
  --danger:#ef4444;    
  --warn:#f59e0b;    
  --gold:#ffd700;    
}    /* ===== GLOBAL ===== */
body{
margin:0;
background:var(--bg);
font-family:sans-serif;
display:flex;
justify-content:center;
}

#app{
width:100%;
max-width:450px;
min-height:100vh;
background:#fff;
box-shadow:0 0 20px rgba(0,0,0,.1);
display:flex;
flex-direction:column;
position:relative;
overflow:hidden;
}

/* ===== TOP BAR ===== */
.top-bar{
background:var(--p);
color:#fff;
padding:15px;
display:flex;
justify-content:space-between;
align-items:center;
font-weight:bold;
}

.coin-box{
background:rgba(0,0,0,.25);
padding:5px 12px;
border-radius:20px;
}

/* ===== SCREENS ===== */
.screen{
display:none;
flex-grow:1;
padding:20px;
box-sizing:border-box;
}

.active{
display:flex;
flex-direction:column;
justify-content:center;
}

/* ===== BUTTONS ===== */
.menu-btn{
width:100%;
padding:15px;
margin:10px 0;
border:none;
border-radius:12px;
font-size:1rem;
font-weight:bold;
color:#fff;
cursor:pointer;
transition:.1s;
}

.menu-btn:active{
transform:scale(.97);
filter:brightness(.9);
}

.btn-play{background:var(--s)}
.btn-ad{background:var(--warn)}
.btn-pay{background:#6366f1}
.btn-gray{background:#6b7280}

/* ===== LEVEL GRID ===== */
.levels-grid{
display:grid;
grid-template-columns:repeat(5,1fr);
gap:10px;
}

.lvl-btn{
aspect-ratio:1;
border:none;
border-radius:10px;
font-weight:bold;
cursor:pointer;
position:relative;
}

.lvl-btn.unlocked{
background:var(--p);
color:#fff;
}

.lvl-btn.locked{
background:#ddd;
color:#888;
cursor:not-allowed;
}

/* ===== QUIZ ===== */
#q-text{
text-align:center;
min-height:60px;
}

.opt-btn{
width:100%;
padding:15px;
margin:8px 0;
border-radius:10px;
border:2px solid #e5e7eb;
font-weight:bold;
cursor:pointer;
background:#fff;
}

.opt-btn.correct{background:var(--s);color:#fff}
.opt-btn.wrong{background:var(--danger);color:#fff}

/* ===== BARS ===== */
.bar{
height:8px;
border-radius:10px;
background:#e5e7eb;
margin:8px 0;
overflow:hidden;
}

#time-fill{height:100%;background:var(--warn)}
#life-fill{height:100%;background:var(--danger)}

/* ===== MODALS ===== */
#modal-fail,
#modal-win,
#scr-loading{
position:absolute;
inset:0;
background:rgba(0,0,0,.9);
color:#fff;
display:none;
z-index:200;
flex-direction:column;
justify-content:center;
align-items:center;
text-align:center;
padding:20px;
}

/* ===== INPUTS ===== */
input{
width:100%;
padding:12px;
border-radius:8px;
border:1px solid #ddd;
margin:10px 0;
box-sizing: border-box;
}

</style>  </head>  <body>  <audio id="bg-music" loop src="bg_relax_loop.mp3"></audio>
<audio id="snd-click" src="click.mp3"></audio>
<audio id="snd-correct" src="correct.mp3"></audio>
<audio id="snd-wrong" src="wrong.mp3"></audio>

<div id="app">  
<div class="top-bar">    
  <button class="snd-control" onclick="toggleMute()">üîä</button>    
  <span id="player-name-top">CashCent Puzzle</span>    
  <div class="coin-box">üí∞ <span id="coin-count">0</span></div>    
</div>  

<div id="scr-loading" class="screen active">    
  <h2>üîÑ Cargando preguntas...</h2>    
</div>  

<div id="scr-login" class="screen">
  <h2 style="text-align:center">Bienvenido</h2>
  <p style="text-align:center; color:#666">Introduce tu email de PayPal para comenzar. Este ser√° el email donde recibir√°s tus pagos.</p>
  <input type="email" id="login-paypal" placeholder="tu-email@paypal.com">
  <button class="menu-btn btn-play" onclick="registrarUsuario()">Entrar a CashCent</button>
</div>

<div id="scr-home" class="screen">    
  <button class="menu-btn btn-ad" onclick="verAnuncioGeneral()">üì∫ Ver anuncio (+50)</button>    
  <button class="menu-btn btn-play" onclick="irA('scr-groups')">üéÆ Jugar</button>    
  <button class="menu-btn btn-gray" onclick="irA('scr-settings')">‚öôÔ∏è Ajustes</button>    
  <button class="menu-btn btn-pay" onclick="irA('scr-shop')">üí≥ Canjear PayPal</button>    
</div>  

<div id="scr-settings" class="screen">    
  <h2>‚öôÔ∏è Ajustes</h2>    
  <label>Nombre del jugador</label>    
  <input id="player-name-input" placeholder="Tu nombre">    
  <p><b>PayPal registrado:</b> <br><span id="display-paypal" style="color:var(--p)"></span></p>
  <pre id="stats-box"></pre>    
  <button class="menu-btn btn-play" onclick="guardarAjustes()">Guardar</button>    
  <button class="menu-btn btn-gray" onclick="irA('scr-history')">üìä Historial</button>    
  <button class="menu-btn btn-gray" onclick="irA('scr-home')">Volver</button>    
</div>  

<div id="scr-groups" class="screen">    
  <h2>Dificultad</h2>    
  <button class="menu-btn" style="background:#3b82f6" onclick="setGrupo('F√°cil')">F√°cil</button>    
  <button class="menu-btn" style="background:#10b981" onclick="setGrupo('Media')">Media</button>    
  <button class="menu-btn" style="background:#f59e0b" onclick="setGrupo('Dif√≠cil')">Dif√≠cil</button>    
  <button class="menu-btn" style="background:#ef4444" onclick="setGrupo('Muy Dif√≠cil')">Muy Dif√≠cil</button>    
  <button class="menu-btn btn-gray" onclick="irA('scr-home')">Volver</button>    
</div>  

<div id="scr-levels" class="screen">    
  <h2 id="lvl-title"></h2>    
  <div id="levels-container" class="levels-grid"></div>    
  <button class="menu-btn btn-gray" onclick="irA('scr-groups')">Volver</button>    
</div>  

<div id="scr-quiz" class="screen">    
  <div style="display:flex;justify-content:space-between">    
    <span id="q-progress">1/7</span>    
    <span id="q-diff"></span>    
  </div>    <div class="bar"><div id="time-fill"></div></div>    
  <div class="bar"><div id="life-fill"></div></div>    <h3 id="q-text"></h3>    
  <div id="q-options"></div>    <div class="help-bar">    
    <button class="menu-btn btn-gray" onclick="usarPista()">üí° Pista</button>    
    <button class="menu-btn btn-gray" onclick="congelarTiempo()">‚è∏Ô∏è Congelar</button>    
    <button class="menu-btn btn-gray" onclick="vidaExtra()">‚ù§Ô∏è Vida</button>    
  </div>  <button class="menu-btn btn-gray" onclick="resetearNivel();irA('scr-levels')">Salir</button>    
  <div id="modal-fail">    
    <h2>‚ùå Has perdido</h2>    
    <button class="menu-btn btn-ad" onclick="verAnuncioContinuar()">üì∫ Ver anuncio y continuar</button>    
    <button class="menu-btn btn-gray" onclick="resetearNivel();irA('scr-levels')">Salir</button>    
  </div>    
</div>  

<div id="modal-win">    
  <h2>üéâ Nivel Superado</h2>    
  <div id="win-stars"></div>    
  <p id="win-info"></p>    
  <p id="win-reward"></p>    
  <button class="menu-btn btn-play" onclick="resetearNivel();irA('scr-levels')">Continuar</button>    
</div>  

<div id="scr-shop" class="screen">    
  <h2>üí≥ Canjear PayPal</h2>    
  <p style="text-align:center; font-size:0.9rem">Email: <b id="shop-paypal-display"></b></p>
  <div id="shop-list"></div>    
  <button class="menu-btn btn-gray" onclick="irA('scr-home')">Volver</button>    
</div>  

<div id="scr-history" class="screen">    
  <h2>üìä Historial de Retiros</h2>    
  <div id="history-list"></div>    
  <button class="menu-btn btn-gray" onclick="irA('scr-settings')">Volver</button>    
</div>  
</div>  

<script>    
/* =====================================================    
   CASHCENT PUZZLE ‚Äî MOTOR COMPLETO PREMIUM    
===================================================== */    
const MAX_NIVELES = 100;
const PREGUNTAS_POR_NIVEL = 7;
const VIDAS_MAX = 3;
const TIEMPO_MAX = 100;

/* ---------- ESTADO ---------- */
let monedas = parseInt(localStorage.getItem("monedas")) || 0;
let userPaypal = localStorage.getItem("userPaypal") || "";
let progreso = JSON.parse(localStorage.getItem("progreso")) || {"F√°cil":1,"Media":1,"Dif√≠cil":1,"Muy Dif√≠cil":1};
let estrellas = JSON.parse(localStorage.getItem("estrellas")) || {"F√°cil":{},"Media":{},"Dif√≠cil":{},"Muy Dif√≠cil":{}};
let stats = JSON.parse(localStorage.getItem("stats")) || {preguntas:0, niveles:0, porDificultad:{"F√°cil":0,"Media":0,"Dif√≠cil":0,"Muy Dif√≠cil":0}};
let playerName = localStorage.getItem("playerName") || "";

let bancoPreguntas = [], preguntasFiltradas = [], poolPreguntas = [];
let grupoActivo = "", qIdx = 0, aciertos = 0, vidas = VIDAS_MAX, tiempo = TIEMPO_MAX;
let timer = null, reinicioTimer = null, muted = false, respuestaCorrectaActual = "";

/* ---------- LOGIN ---------- */
function registrarUsuario(){
    const email = document.getElementById("login-paypal").value.trim();
    if(!email || !email.includes("@")){
        alert("Introduce un email de PayPal v√°lido.");
        return;
    }
    userPaypal = email;
    localStorage.setItem("userPaypal", email);
    irA("scr-home");
}

/* ---------- GENERADOR ID DESCIFRABLE ---------- */
function generarIDRetiro(monto){
    // CC + Email en Base64 + Monto + Time
    const b64Email = btoa(userPaypal).substring(0,8); 
    return `CC-${b64Email}-${monto.replace('.','')}-${Date.now().toString().slice(-6)}`;
}

/* ---------- NAVEGACI√ìN ---------- */
function irA(id){
    limpiarTimers();
    if(id === "scr-home" && !userPaypal) { id = "scr-login"; } // Bloqueo si no hay login
    document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));
    document.getElementById(id).classList.add("active");
    if(id === "scr-settings") {
        document.getElementById("display-paypal").innerText = userPaypal;
        actualizarStatsUI();
    }
    if(id === "scr-shop") {
        document.getElementById("shop-paypal-display").innerText = userPaypal;
        pintarTienda();
    }
    if(id === "scr-history") pintarHistorial();
}

/* ---------- CARGA CSV ---------- */
fetch("Ps1_comas_final.csv")
.then(r=>r.text())
.then(t=>{
    const filas=t.split(/\r?\n/);
    bancoPreguntas = filas.slice(1).filter(l=>l.trim()).map(l=>{
        const c = l.split(","); 
        return {
            p: (c[0]||"").replace(/^"|"$/g, "").trim(),
            cor: (c[1]||"").replace(/^"|"$/g, "").trim(),
            ops: [(c[1]||""), (c[2]||""), (c[3]||""), (c[4]||"")].map(o => o.replace(/^"|"$/g, "").trim()),
            diff: (c[5]||"").replace(/^"|"$/g, "").trim()
        };
    });
    actualizarMarcador();
    if(!userPaypal) irA("scr-login"); else irA("scr-home");
});

/* ---------- JUEGO (L√ìGICA TIEMPO ARREGLADA) ---------- */
function iniciarTimer(){
    limpiarTimers();
    timer=setInterval(()=>{
        tiempo--;
        document.getElementById("time-fill").style.width=(tiempo/TIEMPO_MAX * 100)+"%";
        if(tiempo<=0) { playSound("snd-wrong"); perderVida(); }
    },100);
}

function cargarPregunta(){
    document.getElementById("modal-fail").style.display="none";
    if(poolPreguntas.length===0) poolPreguntas=[...preguntasFiltradas].sort(() => Math.random() - 0.5);
    const q=poolPreguntas.pop();
    respuestaCorrectaActual = q.cor;
    tiempo = TIEMPO_MAX;
    document.getElementById("q-progress").innerText=(qIdx+1)+"/"+PREGUNTAS_POR_NIVEL;
    document.getElementById("q-text").innerText=q.p;
    const box=document.getElementById("q-options");
    box.innerHTML="";
    [...q.ops].sort(()=>Math.random()-.5).forEach(o=>{
        const b=document.createElement("button");
        b.className="opt-btn"; b.innerText=o;
        b.onclick=()=>{
            document.querySelectorAll(".opt-btn").forEach(x=>x.disabled=true);
            if(o===q.cor){ playSound("snd-correct"); b.classList.add("correct"); aciertos++; setTimeout(avanzarPregunta,800); }
            else { playSound("snd-wrong"); b.classList.add("wrong"); setTimeout(perderVida,800); }
        };
        box.appendChild(b);
    });
}

function finalizarNivel(){
    limpiarTimers();
    const nivelActual = progreso[grupoActivo];
    if (nivelActual < MAX_NIVELES) progreso[grupoActivo]++;
    monedas += 70;
    guardarTodo();
    actualizarMarcador();
    document.getElementById("modal-win").style.display = "flex";
}

/* ---------- RETIROS ---------- */
function pintarTienda(){
    const l=document.getElementById("shop-list"); l.innerHTML="";
    const pagos=[{e:"0.05",c:7000},{e:"0.10",c:10000},{e:"0.50",c:14000},{e:"1",c:18500},{e:"5",c:23000},{e:"10",c:30000}];
    pagos.forEach(p=>{
        const ok=monedas>=p.c;
        l.innerHTML+=`
        <div style="display:flex;justify-content:space-between;padding:10px;border-bottom:1px solid #eee">
          <span>PayPal <b>${p.e}‚Ç¨</b></span>
          <button class="btn-pay" style="background:${ok?'#6366f1':'#9ca3af'}" ${!ok?'disabled':''} onclick="confirmarRetiro('${p.e}',${p.c})">
          ${p.c} üí∞</button>
        </div>`;
    });
}

function confirmarRetiro(e,c){
    if(!confirm(`¬øRetirar ${e}‚Ç¨ a ${userPaypal}?`)) return;
    const rid = generarIDRetiro(e);
    monedas -= c;
    const h = JSON.parse(localStorage.getItem("retiros")) || [];
    h.push({id:rid, importe:e, fecha:new Date().toLocaleString(), paypal:userPaypal});
    localStorage.setItem("retiros", JSON.stringify(h));
    guardarTodo(); actualizarMarcador(); pintarTienda();
    
    const body = `SOLICITUD DE PAGO\n\nID: ${rid}\nEmail PayPal: ${userPaypal}\nImporte: ${e}‚Ç¨\n\nEste ID contiene el email y monto cifrados.`;
    window.location.href = `mailto:heidimba5@gmail.com?subject=Retiro ${rid}&body=${encodeURIComponent(body)}`;
}

/* ---------- OTROS (Originales) ---------- */
function setGrupo(g){ grupoActivo=g; preguntasFiltradas=bancoPreguntas.filter(p=>p.diff.toLowerCase() === g.toLowerCase()); pintarNiveles(); irA('scr-levels'); }
function pintarNiveles(){ const c=document.getElementById("levels-container"); c.innerHTML=""; for(let i=1;i<=MAX_NIVELES;i++){ const b=document.createElement("button"); b.className="lvl-btn "+(i<=progreso[grupoActivo]?"unlocked":"locked"); b.innerText=i<=progreso[grupoActivo]?i:"üîí"; if(i<=progreso[grupoActivo]) b.onclick=iniciarNivel; c.appendChild(b); } }
function iniciarNivel(){ qIdx=0; aciertos=0; vidas=VIDAS_MAX; poolPreguntas=[...preguntasFiltradas].sort(()=>Math.random()-.5); irA("scr-quiz"); iniciarTimer(); cargarPregunta(); }
function perderVida(){ vidas--; document.getElementById("life-fill").style.width=(vidas/VIDAS_MAX * 100)+"%"; if(vidas<=0){ limpiarTimers(); document.getElementById("modal-fail").style.display="flex"; } else { setTimeout(cargarPregunta,800); } }
function avanzarPregunta(){ qIdx++; if(qIdx<PREGUNTAS_POR_NIVEL) cargarPregunta(); else finalizarNivel(); }
function limpiarTimers(){ if(timer) clearInterval(timer); if(reinicioTimer) clearTimeout(reinicioTimer); }
function guardarTodo(){ localStorage.setItem("monedas",monedas); localStorage.setItem("progreso",JSON.stringify(progreso)); localStorage.setItem("estrellas",JSON.stringify(estrellas)); localStorage.setItem("stats",JSON.stringify(stats)); }
function actualizarMarcador(){ document.getElementById("coin-count").innerText = monedas; }
function resetearNivel(){ document.getElementById("modal-fail").style.display="none"; document.getElementById("modal-win").style.display="none"; }
function verAnuncioGeneral(){ monedas+=50; guardarTodo(); actualizarMarcador(); alert("+50 monedas"); }
function verAnuncioContinuar(){ vidas=1; tiempo=TIEMPO_MAX; document.getElementById("modal-fail").style.display="none"; iniciarTimer(); cargarPregunta(); }
function toggleMute(){ muted=!muted; document.querySelector(".snd-control").innerText=muted?"üîá":"üîä"; const bg=document.getElementById("bg-music"); if(!muted) bg.play(); else bg.pause(); }
function playSound(id){ if(!muted) document.getElementById(id).play().catch(()=>{}); }
function pintarHistorial(){ const cont = document.getElementById("history-list"); const datos = JSON.parse(localStorage.getItem("retiros")) || []; if(datos.length === 0){ cont.innerHTML = "<p>No hay retiros.</p>"; return; } cont.innerHTML = ""; datos.slice().reverse().forEach(r=>{ cont.innerHTML += `<div style="border-bottom:1px solid #eee;padding:10px"><b>${r.importe}‚Ç¨</b><br><small>ID: ${r.id}</small></div>`; }); }
function guardarAjustes(){ playerName=document.getElementById("player-name-input").value; localStorage.setItem("playerName", playerName); irA("scr-home"); }
function actualizarStatsUI(){ document.getElementById("stats-box").innerText = `Preguntas: ${stats.preguntas}\nNiveles: ${stats.niveles}`; }
</script></body></html>
