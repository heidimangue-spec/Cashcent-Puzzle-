<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cashcent Puzzle - Sistema Completo</title>
    <style>
        :root { --primary: #ffd700; --bg: #121212; --panel: #1e1e1e; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; margin: 0; text-align: center; }
        .header { background: var(--panel); padding: 15px; border-bottom: 2px solid #333; position: sticky; top: 0; z-index: 10; }
        .stats { font-size: 1.4rem; color: var(--primary); font-weight: bold; }
        .container { padding: 20px; max-width: 500px; margin: auto; }
        .btn { background: #333; border: 1px solid #555; padding: 15px; color: white; border-radius: 10px; cursor: pointer; width: 100%; margin: 8px 0; font-size: 1rem; transition: 0.3s; }
        .btn-gold { border-color: var(--primary); color: var(--primary); }
        .btn-green { background: #28a745; border: none; }
        .hidden { display: none; }
        .card { background: var(--panel); padding: 20px; border-radius: 15px; margin-top: 20px; }
    </style>
</head>
<body>

<div class="header">
    <div class="stats" id="txt-saldo">ðŸª™ 0</div>
    <div id="txt-progreso">Selecciona dificultad</div>
</div>

<div class="container">
    <div id="menu-principal">
        <h3>Grupos de Dificultad ðŸ§©</h3>
        <button class="btn btn-gold" onclick="iniciarGrupo(0)">1. FÃ¡cil (1-100)</button>
        <button class="btn btn-gold" onclick="iniciarGrupo(1)">2. Medio (101-200)</button>
        <button class="btn btn-gold" onclick="iniciarGrupo(2)">3. DifÃ­cil (201-300)</button>
        <button class="btn btn-gold" onclick="iniciarGrupo(3)">4. Muy DifÃ­cil (301-400)</button>
        <button class="btn btn-green" onclick="mostrarTienda()">ðŸ›’ Tienda de Retiros</button>
    </div>

    <div id="pantalla-juego" class="hidden">
        <div class="card">
            <h2 id="titulo-nivel">Nivel 1</h2>
            <p id="txt-pregunta">Pregunta 1 de 7</p>
            <div id="area-puzzle" style="margin: 20px 0; font-size: 1.2rem;">Â¿La respuesta es correcta?</div>
            <div style="display: flex; gap: 10px;">
                <button class="btn" onclick="procesarRespuesta(true)">SI</button>
                <button class="btn" onclick="procesarRespuesta(false)">NO</button>
            </div>
        </div>
        <button class="btn" onclick="volverAlMenu()">â¬… Salir al MenÃº</button>
    </div>

    <div id="pantalla-tienda" class="hidden">
        <h3>Retirar Fondos ðŸ’³</h3>
        <div id="lista-pagos"></div>
        <button class="btn" onclick="volverAlMenu()">â¬… Volver</button>
    </div>
</div>

<script>
    // --- 1. CONFIGURACIÃ“N Y ESTADO ---
    const CONFIG = {
        nombresGrupos: ["FÃ¡cil", "Medio", "DifÃ­cil", "Muy DifÃ­cil"],
        nivelesPorGrupo: 100,
        preguntasPorNivel: 7,
        puntosPorAcierto: 2,
        anuncioFrecuencia: 5
    };

    let datos = {
        monedas: 0,
        grupo: 0,
        nivel: 1,
        pregunta: 1,
        aciertosTotales: 0
    };

    let audioCtx;

    // --- 2. MOTOR DE SONIDO (5 Sonidos) ---
    function reproducirSonido(tipo) {
        if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain); gain.connect(audioCtx.destination);
        const t = audioCtx.currentTime;

        if (tipo === 'acierto') { // 1. Sonido Acierto
            osc.frequency.setValueAtTime(500, t);
            osc.frequency.exponentialRampToValueAtTime(1000, t + 0.1);
            gain.gain.setValueAtTime(0.1, t);
            gain.gain.exponentialRampToValueAtTime(0.01, t + 0.2);
            osc.start(); osc.stop(t + 0.2);
        } else if (tipo === 'fallo') { // 2. Sonido EquivocaciÃ³n
            osc.frequency.setValueAtTime(200, t);
            osc.frequency.linearRampToValueAtTime(50, t + 0.3);
            gain.gain.setValueAtTime(0.1, t);
            gain.gain.linearRampToValueAtTime(0.01, t + 0.3);
            osc.start(); osc.stop(t + 0.3);
        } else if (tipo === 'clic') { // 3. Sonido BotÃ³n
            osc.frequency.setValueAtTime(800, t);
            gain.gain.setValueAtTime(0.05, t);
            gain.gain.linearRampToValueAtTime(0.01, t + 0.05);
            osc.start(); osc.stop(t + 0.05);
        }
    }

    // 4. MelodÃ­a de fondo suave (bucle)
    setInterval(() => {
        if (datos.grupo >= 0 && audioCtx && !document.getElementById('pantalla-juego').classList.contains('hidden')) {
            const osc = audioCtx.createOscillator();
            const g = audioCtx.createGain();
            osc.connect(g); g.connect(audioCtx.destination);
            osc.frequency.setValueAtTime(440, audioCtx.currentTime);
            g.gain.setValueAtTime(0.005, audioCtx.currentTime);
            g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 2);
            osc.start(); osc.stop(audioCtx.currentTime + 2);
        }
    }, 4000);

    // --- 3. LÃ“GICA DE JUEGO ---
    function iniciarGrupo(idx) {
        reproducirSonido('clic');
        datos.grupo = idx;
        datos.nivel = 1;
        datos.pregunta = 1;
        mostrarPantalla('pantalla-juego');
        actualizarUI();
    }

    function procesarRespuesta(esCorrecta) {
        if (esCorrecta) {
            reproducirSonido('acierto');
            datos.monedas += CONFIG.puntosPorAcierto;
            datos.aciertosTotales++;
            datos.pregunta++;

            // 5. LÃ³gica de Anuncio Obligatorio (Cada 5 preguntas)
            if (datos.aciertosTotales % CONFIG.anuncioFrecuencia === 0) {
                console.log("mostrarAnuncio"); // SeÃ±al para Niotron
            }

            // Â¿CompletÃ³ las 7 preguntas del nivel?
            if (datos.pregunta > CONFIG.preguntasPorNivel) {
                datos.pregunta = 1;
                datos.nivel++;
                alert("Â¡Nivel " + (datos.nivel - 1) + " Completado!");
                
                if (datos.nivel > CONFIG.nivelesPorGrupo) {
                    alert("Â¡Has terminado el grupo " + CONFIG.nombresGrupos[datos.grupo] + "!");
                    volverAlMenu();
                }
            }
        } else {
            reproducirSonido('fallo');
            alert("Respuesta incorrecta. El nivel se reinicia.");
            datos.pregunta = 1; // Reinicia el progreso del nivel actual
        }
        actualizarUI();
    }

    // --- 4. INTERFAZ Y TIENDA ---
    function actualizarUI() {
        document.getElementById('txt-saldo').innerText = `ðŸª™ ${datos.monedas}`;
        document.getElementById('titulo-nivel').innerText = `Grupo: ${CONFIG.nombresGrupos[datos.grupo]} - Nivel ${datos.nivel}`;
        document.getElementById('txt-pregunta').innerText = `Pregunta ${datos.pregunta} de 7`;
    }

    function mostrarTienda() {
        reproducirSonido('clic');
        const lista = document.getElementById('lista-pagos');
        lista.innerHTML = '';
        const pagos = [
            {eur: "0.05", coste: 50}, {eur: "0.10", coste: 100},
            {eur: "0.50", coste: 500}, {eur: "1.00", coste: 1000},
            {eur: "2.00", coste: 2000}, {eur: "5.00", coste: 5000},
            {eur: "10.00", coste: 9000}, {eur: "20.00", coste: 18000}
        ];

        pagos.forEach(p => {
            const btn = document.createElement('button');
            btn.className = 'btn';
            btn.innerText = `Retirar ${p.eur}â‚¬ (${p.coste} ðŸª™)`;
            btn.onclick = () => {
                if (datos.monedas >= p.coste) {
                    datos.monedas -= p.coste;
                    actualizarUI();
                    alert("Solicitud de " + p.eur + "â‚¬ enviada correctamente.");
                } else {
                    alert("Necesitas " + (p.coste - datos.monedas) + " monedas mÃ¡s.");
                }
            };
            lista.appendChild(btn);
        });
        mostrarPantalla('pantalla-tienda');
    }

    function mostrarPantalla(id) {
        document.getElementById('menu-principal').classList.add('hidden');
        document.getElementById('pantalla-juego').classList.add('hidden');
        document.getElementById('pantalla-tienda').classList.add('hidden');
        document.getElementById(id).classList.remove('hidden');
    }

    function volverAlMenu() {
        reproducirSonido('clic');
        mostrarPantalla('menu-principal');
    }

    // FunciÃ³n que llama Niotron para dar monedas extra por anuncio voluntario
    function darRecompensa() {
        datos.monedas += 50;
        actualizarUI();
    }
</script>
</body>
</html>
