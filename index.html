<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CashCent Puzzle</title>
</head>

<body>

<!-- ================= AUDIO ================= -->
<audio id="bg-music" loop src="bg_relax_loop.mp3"></audio>
<audio id="snd-click" src="click.mp3"></audio>
<audio id="snd-correct" src="correct.mp3"></audio>
<audio id="snd-wrong" src="wrong.mp3"></audio>

<!-- ================= APP ================= -->
<div id="app">

<!-- ===== TOP BAR ===== -->
<div class="top-bar">
  <button class="snd-control" onclick="toggleMute()">ğŸ”Š</button>
  <span id="player-name-top">CashCent Puzzle</span>
  <div class="coin-box">ğŸ’° <span id="coin-count">0</span></div>
</div>

<!-- ===== LOADING ===== -->
<div id="scr-loading" class="screen active">
  <h2>ğŸ”„ Cargando preguntas...</h2>
</div>

<!-- ===== HOME ===== -->
<div id="scr-home" class="screen">
  <button class="menu-btn btn-ad" onclick="verAnuncioGeneral()">ğŸ“º Ver anuncio (+50)</button>
  <button class="menu-btn btn-play" onclick="irA('scr-groups')">ğŸ® Jugar</button>
  <button class="menu-btn btn-gray" onclick="irA('scr-settings')">âš™ï¸ Ajustes</button>
  <button class="menu-btn btn-pay" onclick="irA('scr-shop')">ğŸ’³ Canjear PayPal</button>
</div>

<!-- ===== SETTINGS ===== -->
<div id="scr-settings" class="screen">
  <h2>âš™ï¸ Ajustes</h2>

  <label>Nombre del jugador</label>
  <input id="player-name-input" placeholder="Tu nombre">

  <pre id="stats-box"></pre>

  <button class="menu-btn btn-pay" onclick="irA('scr-support')">ğŸ“© AtenciÃ³n al Cliente</button>
  <button class="menu-btn btn-gray" onclick="irA('scr-faq')">â“ Preguntas Frecuentes</button>

  <button class="menu-btn btn-play" onclick="guardarAjustes()">Guardar</button>
  <button class="menu-btn btn-gray" onclick="irA('scr-home')">Volver</button>
</div>

<!-- ===== FAQ ===== -->
<div id="scr-faq" class="screen">
  <h2>â“ Preguntas Frecuentes</h2>

  <p><b>ğŸ’° Â¿CÃ³mo gano monedas?</b><br>Jugando niveles y viendo anuncios.</p>
  <p><b>ğŸ“º Â¿Por quÃ© hay lÃ­mite de anuncios?</b><br>Para evitar abusos.</p>
  <p><b>ğŸ’³ Â¿PayPal es real?</b><br>SÃ­, los pagos se procesan manualmente.</p>
  <p><b>â³ Â¿CuÃ¡nto tarda un retiro?</b><br>Entre 24 y 72 horas.</p>

  <button class="menu-btn btn-gray" onclick="irA('scr-settings')">Volver</button>
</div>

<!-- ===== SOPORTE ===== -->
<div id="scr-support" class="screen">
  <h2>ğŸ“© AtenciÃ³n al Cliente</h2>

  <input id="support-subject" placeholder="Asunto">
  <textarea id="support-message" rows="5" placeholder="Describe tu problema"></textarea>

  <button class="menu-btn btn-play" onclick="enviarSoporte()">Enviar mensaje</button>
  <button class="menu-btn btn-gray" onclick="irA('scr-settings')">Volver</button>
</div>

<!-- ===== DIFICULTADES ===== -->
<div id="scr-groups" class="screen">
  <h2>Dificultad</h2>

  <button class="menu-btn" style="background:#3b82f6" onclick="setGrupo('FÃ¡cil')">FÃ¡cil</button>
  <button class="menu-btn" style="background:#10b981" onclick="setGrupo('Media')">Media</button>
  <button class="menu-btn" style="background:#f59e0b" onclick="setGrupo('DifÃ­cil')">DifÃ­cil</button>
  <button class="menu-btn" style="background:#ef4444" onclick="setGrupo('Muy DifÃ­cil')">Muy DifÃ­cil</button>

  <button class="menu-btn btn-gray" onclick="irA('scr-home')">Volver</button>
</div>

<!-- ===== LEVELS ===== -->
<div id="scr-levels" class="screen">
  <h2 id="lvl-title"></h2>
  <div id="levels-container" class="levels-grid"></div>
  <button class="menu-btn btn-gray" onclick="irA('scr-groups')">Volver</button>
</div>

<!-- ===== QUIZ ===== -->
<div id="scr-quiz" class="screen">

  <div style="display:flex;justify-content:space-between">
    <span id="q-progress">1/7</span>
    <span id="q-diff">Dificultad</span>
  </div>

  <div class="bar"><div id="time-fill"></div></div>
  <div class="bar"><div id="life-fill"></div></div>

  <h3 id="q-text"></h3>
  <div id="q-options"></div>

  <button class="menu-btn btn-gray" onclick="resetearNivel();irA('scr-levels')">Salir</button>

  <div id="modal-fail">
    <h2>âŒ Has perdido</h2>
    <button class="menu-btn btn-ad" onclick="verAnuncioContinuar()">Ver anuncio y continuar</button>
    <button class="menu-btn btn-gray" onclick="resetearNivel();irA('scr-levels')">Salir</button>
  </div>

</div>

<!-- ===== WIN MODAL ===== -->
<div id="modal-win">
  <h2>ğŸ‰ Nivel Superado</h2>
  <div id="win-stars"></div>
  <p id="win-info"></p>
  <p id="win-reward"></p>
  <button class="menu-btn btn-play" onclick="resetearNivel();irA('scr-levels')">Continuar</button>
</div>

<!-- ===== SHOP PAYPAL ===== -->
<div id="scr-shop" class="screen">
  <h2>ğŸ’³ Canjear PayPal</h2>
  <div id="shop-list"></div>
  <button class="menu-btn btn-gray" onclick="irA('scr-home')">Volver</button>
</div>

</div>
<!-- ================= END APP ================= -->
<style>
:root{
  --p:#2563eb;
  --s:#10b981;
  --bg:#f3f4f6;
  --danger:#ef4444;
  --warn:#f59e0b;
  --gold:#ffd700;
}

/* ===== GLOBAL ===== */
body{
  margin:0;
  background:var(--bg);
  font-family:sans-serif;
  display:flex;
  justify-content:center;
}

#app{
  width:100%;
  max-width:450px;
  min-height:100vh;
  background:#fff;
  box-shadow:0 0 20px rgba(0,0,0,.1);
  display:flex;
  flex-direction:column;
  position:relative;
  overflow:hidden;
}

/* ===== TOP BAR ===== */
.top-bar{
  background:var(--p);
  color:#fff;
  padding:15px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-weight:bold;
}

.coin-box{
  background:rgba(0,0,0,.25);
  padding:5px 12px;
  border-radius:20px;
}

/* ===== SCREENS ===== */
.screen{
  display:none;
  flex-grow:1;
  padding:20px;
  box-sizing:border-box;
}

.active{
  display:flex;
  flex-direction:column;
  justify-content:center;
}

/* ===== BUTTONS ===== */
.menu-btn{
  width:100%;
  padding:15px;
  margin:10px 0;
  border:none;
  border-radius:12px;
  font-size:1rem;
  font-weight:bold;
  color:#fff;
  cursor:pointer;
  transition:transform .1s, filter .1s;
}

.menu-btn:active{
  transform:scale(.97);
  filter:brightness(.9);
}

.btn-play{background:var(--s)}
.btn-ad{background:var(--warn)}
.btn-pay{background:#6366f1}
.btn-gray{background:#6b7280}

/* ===== LEVEL GRID ===== */
.levels-grid{
  display:grid;
  grid-template-columns:repeat(5,1fr);
  gap:10px;
}

.lvl-btn{
  aspect-ratio:1;
  border:none;
  border-radius:10px;
  font-weight:bold;
  cursor:pointer;
  position:relative;
  font-size:1rem;
}

.lvl-btn.unlocked{
  background:var(--p);
  color:#fff;
}

.lvl-btn.locked{
  background:#ddd;
  color:#888;
  cursor:not-allowed;
}

.star-mini{
  position:absolute;
  bottom:4px;
  left:0;
  right:0;
  text-align:center;
  font-size:.7rem;
  color:var(--gold);
}

/* ===== QUIZ ===== */
#q-text{
  text-align:center;
  min-height:60px;
}

.opt-btn{
  width:100%;
  padding:15px;
  margin:8px 0;
  border-radius:10px;
  border:2px solid #e5e7eb;
  font-weight:bold;
  cursor:pointer;
  transition:background .2s, color .2s;
  background:#fff;
}

.opt-btn.correct{
  background:var(--s);
  color:#fff;
}

.opt-btn.wrong{
  background:var(--danger);
  color:#fff;
}

/* ===== BARS ===== */
.bar{
  height:8px;
  border-radius:10px;
  background:#e5e7eb;
  margin:8px 0;
  overflow:hidden;
}

#time-fill{
  height:100%;
  background:var(--warn);
  transition:width .1s linear;
}

#life-fill{
  height:100%;
  background:var(--danger);
  transition:width .5s ease-in-out;
}

/* ===== FLASH ERROR ===== */
@keyframes flashError{
  0%{background:rgba(239,68,68,.6)}
  100%{background:transparent}
}

.flash-error{
  animation:flashError .15s;
}

/* ===== MODALS ===== */
#modal-fail,
#modal-win,
#scr-loading{
  position:absolute;
  inset:0;
  background:rgba(0,0,0,.9);
  color:#fff;
  display:none;
  z-index:200;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  text-align:center;
  padding:20px;
  box-sizing:border-box;
}

#modal-win{
  gap:10px;
}

#win-stars{
  font-size:2rem;
  color:var(--gold);
}

/* ===== INPUTS ===== */
input,textarea{
  width:100%;
  padding:10px;
  border-radius:8px;
  border:none;
  margin:8px 0;
  font-size:1rem;
  box-sizing:border-box;
}

/* ===== SOUND BUTTON ===== */
.snd-control{
  background:none;
  border:none;
  color:#fff;
  font-size:1.2rem;
  cursor:pointer;
}
</style>
<script>
/* =====================================================
   CASHCENT PUZZLE â€” LÃ“GICA COMPLETA FINAL
===================================================== */

/* ---------- CONSTANTES ---------- */
const MAX_NIVELES = 100;
const PREGUNTAS_POR_NIVEL = 7;
const VIDAS_MAX = 3;
const TIEMPO_MAX = 100;
const ANUNCIOS_DIARIOS_MAX = 3;

/* ---------- ESTADO PERSISTENTE ---------- */
let monedas = parseInt(localStorage.getItem("monedas")) || 0;
let progreso = JSON.parse(localStorage.getItem("progreso")) || {
 "FÃ¡cil":1,"Media":1,"DifÃ­cil":1,"Muy DifÃ­cil":1
};
let estrellas = JSON.parse(localStorage.getItem("estrellas")) || {
 "FÃ¡cil":{},"Media":{},"DifÃ­cil":{},"Muy DifÃ­cil":{}
};
let stats = JSON.parse(localStorage.getItem("stats")) || {
 preguntas:0,
 niveles:0,
 porDificultad:{"FÃ¡cil":0,"Media":0,"DifÃ­cil":0,"Muy DifÃ­cil":0}
};
let playerName = localStorage.getItem("playerName") || "";

/* ---------- ANUNCIOS DIARIOS ---------- */
let hoy = new Date().toISOString().slice(0,10);
let adsData = JSON.parse(localStorage.getItem("adsData")) || {fecha:hoy, vistos:0};
if(adsData.fecha !== hoy){
 adsData = {fecha:hoy, vistos:0};
 localStorage.setItem("adsData",JSON.stringify(adsData));
}

/* ---------- ESTADO DE PARTIDA ---------- */
let bancoPreguntas = [];
let preguntasFiltradas = [];
let poolPreguntas = [];
let grupoActivo = "";
let qIdx = 0;
let aciertos = 0;
let vidas = VIDAS_MAX;
let tiempo = TIEMPO_MAX;
let timer = null;
let muted = false;

/* ---------- AUDIO ---------- */
function playSound(id){
 if(muted) return;
 const s = document.getElementById(id);
 if(s){
  s.currentTime = 0;
  s.play().catch(()=>{});
 }
}
function toggleMute(){
 muted = !muted;
 document.querySelector(".snd-control").innerText = muted ? "ğŸ”‡" : "ğŸ”Š";
 if(!muted){
  document.getElementById("bg-music").play().catch(()=>{});
 }
}

/* ---------- UTILIDADES ---------- */
function guardarTodo(){
 localStorage.setItem("monedas",monedas);
 localStorage.setItem("progreso",JSON.stringify(progreso));
 localStorage.setItem("estrellas",JSON.stringify(estrellas));
 localStorage.setItem("stats",JSON.stringify(stats));
 localStorage.setItem("playerName",playerName);
 localStorage.setItem("adsData",JSON.stringify(adsData));
}
function actualizarMarcador(){
 document.getElementById("coin-count").innerText = monedas;
}

/* ---------- LIMPIEZA ---------- */
function limpiarTimers(){
 if(timer){
  clearInterval(timer);
  timer = null;
 }
}

/* ---------- NAVEGACIÃ“N ---------- */
function irA(id){
 limpiarTimers();
 playSound("snd-click");
 document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));
 document.getElementById(id).classList.add("active");
 if(id==="scr-settings") actualizarStatsUI();
 if(id==="scr-shop") pintarTienda();
}

/* ---------- CARGA CSV ---------- */
fetch("Ps1_comas_final.csv")
.then(r=>r.text())
.then(t=>{
 const filas = t.split("\n").slice(1);
 bancoPreguntas = filas.filter(l=>l.trim()).map(l=>{
  const c = l.split(",");
  return {p:c[0], cor:c[1], ops:[c[1],c[2],c[3],c[4]], diff:c[5].trim()};
 });
 document.getElementById("player-name-top").innerText = playerName || "CashCent Puzzle";
 actualizarMarcador();
 irA("scr-home");
});

/* ---------- DIFICULTADES ---------- */
function setGrupo(g){
 grupoActivo = g;
 preguntasFiltradas = bancoPreguntas.filter(p=>p.diff===g);
 document.getElementById("lvl-title").innerText = "Niveles: "+g;
 pintarNiveles();
 irA("scr-levels");
}

/* ---------- NIVELES ---------- */
function pintarNiveles(){
 const c = document.getElementById("levels-container");
 c.innerHTML="";
 for(let i=1;i<=MAX_NIVELES;i++){
  const b=document.createElement("button");
  b.className="lvl-btn";
  if(i<=progreso[grupoActivo]){
   b.classList.add("unlocked");
   b.innerText=i;
   if(estrellas[grupoActivo][i]){
    const s=document.createElement("div");
    s.className="star-mini";
    s.innerText="â­".repeat(estrellas[grupoActivo][i]);
    b.appendChild(s);
   }
   b.onclick=()=>iniciarNivel();
  }else{
   b.classList.add("locked");
   b.innerText="ğŸ”’";
  }
  c.appendChild(b);
 }
}

/* ---------- NIVEL ---------- */
function iniciarNivel(){
 qIdx=0;
 aciertos=0;
 vidas=VIDAS_MAX;
 tiempo=TIEMPO_MAX;
 poolPreguntas=[...preguntasFiltradas];
 irA("scr-quiz");
 iniciarTimer();
 cargarPregunta();
}

/* ---------- TIMER ---------- */
function iniciarTimer(){
 limpiarTimers();
 actualizarBarras();
 timer=setInterval(()=>{
  tiempo--;
  actualizarBarras();
  if(tiempo<=0) perderVida();
 },100);
}
function actualizarBarras(){
 document.getElementById("time-fill").style.width=(tiempo/TIEMPO_MAX*100)+"%";
 document.getElementById("life-fill").style.width=(vidas/VIDAS_MAX*100)+"%";
}

/* ---------- PREGUNTAS ---------- */
function cargarPregunta(){
 document.getElementById("modal-fail").style.display="none";
 if(poolPreguntas.length===0) poolPreguntas=[...preguntasFiltradas];

 const q=poolPreguntas.splice(Math.floor(Math.random()*poolPreguntas.length),1)[0];

 document.getElementById("q-progress").innerText=(qIdx+1)+"/"+PREGUNTAS_POR_NIVEL;
 document.getElementById("q-diff").innerText=grupoActivo;
 document.getElementById("q-text").innerText=q.p;

 const box=document.getElementById("q-options");
 box.innerHTML="";
 q.ops.sort(()=>Math.random()-.5).forEach(o=>{
  const b=document.createElement("button");
  b.className="opt-btn";
  b.innerText=o;
  b.dataset.correcta=o===q.cor;
  b.onclick=()=>{
   document.querySelectorAll(".opt-btn").forEach(x=>x.disabled=true);
   stats.preguntas++;
   if(o===q.cor){
    playSound("snd-correct");
    b.classList.add("correct");
    aciertos++;
    setTimeout(avanzarPregunta,800);
   }else{
    playSound("snd-wrong");
    b.classList.add("wrong");
    document.body.classList.add("flash-error");
    setTimeout(()=>document.body.classList.remove("flash-error"),150);
    setTimeout(perderVida,800);
   }
  };
  box.appendChild(b);
 });
}

/* ---------- AVANCE ---------- */
function avanzarPregunta(){
 qIdx++;
 if(qIdx%5===0) verAnuncioObligatorio();
 if(qIdx<PREGUNTAS_POR_NIVEL) cargarPregunta();
 else finalizarNivel();
}

/* ---------- VIDAS ---------- */
function perderVida(){
 vidas--;
 actualizarBarras();
 if(vidas<=0){
  document.getElementById("modal-fail").style.display="flex";
 }else{
  tiempo=TIEMPO_MAX;
  setTimeout(cargarPregunta,800);
 }
}

/* ---------- FINAL ---------- */
function finalizarNivel(){
 limpiarTimers();
 let estrellasGanadas=vidas>=3?3:vidas>=2?2:1;

 const nivelActual=progreso[grupoActivo];
 estrellas[grupoActivo][nivelActual]=Math.max(estrellas[grupoActivo][nivelActual]||0,estrellasGanadas);

 monedas+=70;
 stats.niveles++;
 stats.porDificultad[grupoActivo]++;

 if(progreso[grupoActivo]<MAX_NIVELES) progreso[grupoActivo]++;

 guardarTodo();
 actualizarMarcador();

 document.getElementById("win-stars").innerText="â­".repeat(estrellasGanadas);
 document.getElementById("win-info").innerText="Aciertos: "+aciertos+"/"+PREGUNTAS_POR_NIVEL;
 document.getElementById("win-reward").innerText="+70 monedas";
 document.getElementById("modal-win").style.display="flex";
}

/* ---------- RESET ---------- */
function resetearNivel(){
 limpiarTimers();
 document.getElementById("modal-fail").style.display="none";
 document.getElementById("modal-win").style.display="none";
}

/* ---------- ANUNCIOS ---------- */
function verAnuncioGeneral(){
 if(adsData.vistos>=ANUNCIOS_DIARIOS_MAX){alert("LÃ­mite diario alcanzado");return;}
 adsData.vistos++; monedas+=50;
 guardarTodo(); actualizarMarcador();
 alert("Anuncio visto (+50)");
}
function verAnuncioContinuar(){
 if(adsData.vistos>=ANUNCIOS_DIARIOS_MAX){alert("LÃ­mite diario alcanzado");return;}
 adsData.vistos++; vidas=1; tiempo=TIEMPO_MAX;
 guardarTodo();
 document.getElementById("modal-fail").style.display="none";
 iniciarTimer(); cargarPregunta();
}
function verAnuncioObligatorio(){
 alert("Anuncio obligatorio");
}

/* ---------- AJUSTES ---------- */
function guardarAjustes(){
 playerName=document.getElementById("player-name-input").value.trim();
 document.getElementById("player-name-top").innerText=playerName||"CashCent Puzzle";
 guardarTodo();
 irA("scr-home");
}
function actualizarStatsUI(){
 document.getElementById("stats-box").innerText=
  "Preguntas: "+stats.preguntas+"\n"+
  "Niveles: "+stats.niveles+"\n"+
  "FÃ¡cil: "+stats.porDificultad["FÃ¡cil"]+"\n"+
  "Media: "+stats.porDificultad["Media"]+"\n"+
  "DifÃ­cil: "+stats.porDificultad["DifÃ­cil"]+"\n"+
  "Muy DifÃ­cil: "+stats.porDificultad["Muy DifÃ­cil"];
 document.getElementById("player-name-input").value=playerName;
}

/* ---------- SOPORTE ---------- */
function enviarSoporte(){
 const a=document.getElementById("support-subject").value;
 const m=document.getElementById("support-message").value;
 window.location.href=
  "mailto:heidimba5@gmail.com?subject="+encodeURIComponent(a)+
  "&body="+encodeURIComponent(m);
}

/* ---------- PAYPAL ---------- */
function pintarTienda(){
 const l=document.getElementById("shop-list");
 l.innerHTML="";
 const pagos=[0.05,0.1,0.5,1,5,10,15,20];
 pagos.forEach(e=>{
  const c=Math.floor(e*700);
  l.innerHTML+=`<div>${e}â‚¬ <button onclick="retirar(${e},${c})">${c} ğŸ’°</button></div>`;
 });
}
function retirar(e,c){
 if(monedas<c){alert("Monedas insuficientes");return;}
 monedas-=c;
 guardarTodo(); actualizarMarcador();
 window.location.href=
  "mailto:heidimba5@gmail.com?subject=Retiro PayPal&body=Importe: "+e+"â‚¬";
}

/* ---------- BACK BUTTON ---------- */
window.onpopstate=()=>irA("scr-home");
 </script>
